services:
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared
    environment:
      - TZ=America/Chicago
      - TUNNEL_TOKEN=${TOKEN}
    restart: unless-stopped
    command: tunnel --no-autoupdate run

  portainer:
    image: portainer/portainer-ce:lts
    container_name: portainer
    # cloudflare tunnel to https://172.17.0.1:9443
    ports:
      - 9443:9443
    volumes:
      - data:/data
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped

  beszel-agent:
    image: henrygd/beszel-agent
    container_name: beszel-agent
    restart: unless-stopped
    network_mode: host
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ~/beszel_agent_data:/var/lib/beszel-agent
      # - ~/beszel_socket:/beszel_socket
      # monitor other disks / partitions by mounting a folder in /extra-filesystems
      # - /mnt/disk/.beszel:/extra-filesystems/sda1:ro
    environment:
      LISTEN: 45876
      KEY: "ssh-ed25519 key"
      TOKEN:
        "token"
        # HUB_URL: http://localhost:8090

#  whoami:
#    image: traefik/whoami:v1.11
#    container_name: whoami
#    ports:
#      - 2001:2001
#    restart: unless-stopped
#    command:
#      - --port=2001
#      - --name=iamfoo

volumes:
  data:
